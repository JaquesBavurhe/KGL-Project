<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Karibu Groceries - Manager Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1" rel="stylesheet">
  <link rel="stylesheet" href="../css/dashboardShared.css">
</head>
<body>
  <div class="app-shell">
    <aside class="sidebar">
      <div class="sidebar-logo-container">
        <div>
          <a href="/"><img src="../assets/logo/logo-icon.png" width="auto" height="40" alt="kgl-logo"></a>
        </div>
        <span class="logo-text">KaribuGroceries</span>
      </div>

      <nav class="nav-list custom-scrollbar">
        <button class="nav-item active" data-target="overview">
          <span class="material-symbols-outlined">grid_view</span>
          <span class="nav-label">Dashboard Overview</span>
        </button>
        <button class="nav-item" data-target="cash-sales">
          <span class="material-symbols-outlined">payments</span>
          <span class="nav-label">Record Cash Sale</span>
        </button>
        <button class="nav-item" data-target="credit-sales">
          <span class="material-symbols-outlined">credit_card</span>
          <span class="nav-label">Record Credit Sale</span>
        </button>
        <button class="nav-item" data-target="procurement">
          <span class="material-symbols-outlined">shopping_cart</span>
          <span class="nav-label">Record Procurement</span>
        </button>
        <button class="nav-item" data-target="records">
          <span class="material-symbols-outlined">receipt_long</span>
          <span class="nav-label">Branch Records</span>
        </button>
        <button class="nav-item" data-target="stock">
          <span class="material-symbols-outlined">inventory_2</span>
          <span class="nav-label">Stock Summary</span>
        </button>
      </nav>

      <div style="padding: 12px; border-top: 1px solid rgba(255,255,255,0.05); margin-top: auto;">
        <button class="nav-item" style="color: #f43f5e;" id="logoutButton">
          <span class="material-symbols-outlined">logout</span>
          <span class="nav-label">Logout</span>
        </button>
      </div>
    </aside>

    <div class="main-content-area">
      <header class="header">
        <div class="search-bar">
          <span class="material-symbols-outlined search-icon">search</span>
          <input id="recordSearch" type="text" placeholder="Search branch records by buyer, produce, dealer...">
        </div>

        <div class="header-actions">
          <button
            id="notificationToggle"
            style="border: none; background: none; color: #64748b; position: relative; cursor: pointer;"
            aria-label="View stock alerts"
            type="button"
          >
            <span class="material-symbols-outlined">notifications</span>
            <span
              id="notificationBadge"
              style="display:none; position: absolute; top: 2px; right: 2px; min-width: 14px; height: 14px; padding: 0 4px; background: #f43f5e; border-radius: 999px; border: 1px solid white; color: white; font-size: 9px; line-height: 12px; font-weight: 700; text-align: center;"
            >0</span>
          </button>
          <div class="profile-section">
            <div style="text-align: right;">
              <p id="profileName" style="font-size: 12px; font-weight: 800; margin: 0;">Loading...</p>
              <p id="profileMeta" style="font-size: 9px; font-weight: 600; color: #94a3b8; text-transform: uppercase; margin-top: 2px;">Manager</p>
            </div>
            <div class="profile-img">
              <span class="material-symbols-outlined">person</span>
            </div>
          </div>
        </div>
      </header>
      <div
        id="notificationPanel"
        style="display:none; position:absolute; top:72px; right:24px; width:340px; max-height:360px; overflow:auto; z-index:30; background:#ffffff; border:1px solid #e2e8f0; border-radius:14px; box-shadow:0 16px 40px rgba(15, 23, 42, 0.15); padding:12px;"
      >
        <p style="font-size:12px; font-weight:800; margin:0 0 8px 0;">Stock Alerts</p>
        <div id="notificationList" style="display:flex; flex-direction:column; gap:8px;"></div>
      </div>

      <main class="scrollable-view custom-scrollbar">
        <section id="overview" class="view-section active">
          <div class="hero">
            <div class="hero-content">
              <h2 id="overviewGreeting">Welcome, Manager</h2>
              <p id="userContext">Loading branch dashboard...</p>
            </div>
            <svg class="hero-svg" viewBox="0 0 400 400">
              <path d="M0,256L48,229.3C96,203,192,149,288,154.7C384,160,480,224,576,218.7C672,213,768,139,864,122.7C960,107,1056,149,1152,154.7C1248,160,1344,128,1392,112L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
            </svg>
          </div>

          <div class="kpi-grid">
            <div class="card">
              <span class="card-title">Cash Sales Count</span>
              <div class="card-value"><span id="cashCount">0</span></div>
            </div>
            <div class="card">
              <span class="card-title">Credit Sales Count</span>
              <div class="card-value"><span id="creditCount">0</span></div>
            </div>
            <div class="card">
              <span class="card-title">Procurements</span>
              <div class="card-value"><span id="procurementCount">0</span></div>
            </div>
            <div class="card">
              <span class="card-title">Current Stock (KG)</span>
              <div class="card-value"><span id="stockQty">0</span></div>
            </div>
          </div>
        </section>

        <section id="cash-sales" class="view-section">
          <h3 class="section-title">Record Cash Sale</h3>
          <article class="card">
            <form id="cashSaleForm">
              <div class="form-grid">
                <div class="field-wrap"><label>Produce Name</label><input name="produceName" required></div>
                <div class="field-wrap"><label>Buyer Name</label><input name="buyerName" required></div>
                <div class="field-wrap"><label>Tonnage (kg)</label><input name="tonnageKg" type="number" min="1" required></div>
                <div class="field-wrap"><label>Amount Paid (UGX)</label><input name="amountPaid" type="number" min="1" required readonly></div>
                <div class="field-wrap"><label>Sale Date</label><input name="date" type="datetime-local"></div>
              </div>
              <button class="btn-primary" type="submit">Save Cash Sale</button>
              <div id="cashStatus" class="status"></div>
            </form>
          </article>
        </section>

        <section id="credit-sales" class="view-section">
          <h3 class="section-title">Record Credit Sale</h3>
          <article class="card">
            <form id="creditSaleForm">
              <div class="form-grid">
                <div class="field-wrap"><label>Produce Name</label><input name="produceName" required></div>
                <div class="field-wrap"><label>Buyer Name</label><input name="buyerName" required></div>
                <div class="field-wrap"><label>Tonnage (kg)</label><input name="tonnageKg" type="number" min="1" required></div>
                <div class="field-wrap"><label>Amount Due (UGX)</label><input name="amountDue" type="number" min="1" required readonly></div>
                <div class="field-wrap"><label>Buyer NIN</label><input name="buyerNIN" required></div>
                <div class="field-wrap"><label>Buyer Contact</label><input name="buyerContact" required></div>
                <div class="field-wrap"><label>Buyer Location</label><input name="buyerLocation" required></div>
                <div class="field-wrap"><label>Due Date</label><input name="dueDate" type="date" required></div>
              </div>
              <button class="btn-primary" type="submit">Save Credit Sale</button>
              <div id="creditStatus" class="status"></div>
            </form>
          </article>
        </section>

        <section id="procurement" class="view-section">
          <h3 class="section-title">Record Procurement</h3>
          <article class="card">
            <form id="procurementForm">
              <div class="form-grid">
                <div class="field-wrap"><label>Produce Name</label><input name="produceName" required></div>
                <div class="field-wrap"><label>Produce Type</label><input name="produceType" required></div>
                <div class="field-wrap"><label>Tonnage (kg)</label><input name="tonnage" type="number" min="1" required></div>
                <div class="field-wrap"><label>Total Cost (UGX)</label><input name="cost" type="number" min="1" required></div>
                <div class="field-wrap"><label>Dealer Name</label><input name="dealerName" required></div>
                <div class="field-wrap"><label>Dealer Contact</label><input name="dealerContact" required></div>
                <div class="field-wrap"><label>Selling Price Per KG (UGX)</label><input name="sellingPrice" type="number" min="0" required></div>
                <div class="field-wrap"><label>Date</label><input name="date" type="datetime-local"></div>
              </div>
              <button class="btn-primary" type="submit">Save Procurement</button>
              <div id="procurementStatus" class="status"></div>
            </form>
          </article>
        </section>

        <section id="records" class="view-section">
          <h3 class="section-title">Branch Sales Records</h3>
          <article class="card">
            <div class="table-container custom-scrollbar">
              <table>
                <thead>
                  <tr>
                    <th>Type</th>
                    <th>Produce</th>
                    <th>Name</th>
                    <th>Tonnage (kg)</th>
                    <th>Amount (UGX)</th>
                    <th>Status</th>
                    <th>Date</th>
                  </tr>
                </thead>
                <tbody id="salesRecordsBody"></tbody>
              </table>
            </div>
            <div id="recordsStatus" class="status"></div>
          </article>

          <h3 class="section-title" style="margin-top: 18px;">Branch Procurement Records</h3>
          <article class="card">
            <div class="table-container custom-scrollbar">
              <table>
                <thead>
                  <tr>
                    <th>Produce</th>
                    <th>Type</th>
                    <th>Tonnage (kg)</th>
                    <th>Cost (UGX)</th>
                    <th>Dealer</th>
                    <th>Date</th>
                  </tr>
                </thead>
                <tbody id="procurementRecordsBody"></tbody>
              </table>
            </div>
          </article>
        </section>

        <section id="stock" class="view-section">
          <h3 class="section-title">Branch Stock Summary</h3>
          <div class="kpi-grid">
            <div class="card">
              <span class="card-title">Stock Items</span>
              <div class="card-value"><span id="stockItems">0</span></div>
            </div>
            <div class="card">
              <span class="card-title">Total Quantity (KG)</span>
              <div class="card-value"><span id="stockQuantity">0</span></div>
            </div>
            <div class="card">
              <span class="card-title">Estimated Value (UGX)</span>
              <div class="card-value"><span id="stockValue">0</span></div>
            </div>
            <div class="card">
              <span class="card-title">Low Stock Alerts</span>
              <div class="card-value"><span id="lowStockCount">0</span></div>
            </div>
          </div>
          <article class="card">
            <span class="card-title">Low Stock Items</span>
            <div class="table-container custom-scrollbar" style="margin-top: 12px;">
              <table>
                <thead>
                  <tr>
                    <th>Produce</th>
                    <th>Type</th>
                    <th>Quantity (KG)</th>
                    <th>Selling Price (UGX)</th>
                  </tr>
                </thead>
                <tbody id="lowStockBody"></tbody>
              </table>
            </div>
            <div id="stockStatus" class="status"></div>
          </article>
        </section>
      </main>
    </div>
  </div>

  <script src="../js/managerDashboard.js"></script>
</body>
</html>
